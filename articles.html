<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <title id="page-title">文章列表 - 谷比算力</title>
    <meta name="keywords" id="page-keywords" content="区块链策略开发, 量化交易策略, 数据采集, 行情数据接口, K线数据, 交易所API, 策略回测, Web3数据, 区块链数据分析, 自动化交易">
    <meta name="description" id="page-description" content="我们专注于区块链与量化交易领域，提供策略开发、数据采集、行情接口与回测服务，助力用户高效获取链上与交易所数据，打造智能化交易与分析解决方案。">
    <!-- 引入Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- 引入样式文件 -->
    <link rel="stylesheet" href="../styles.css">
    
    <!-- 网站配置加载脚本 -->
    <script>
        // 加载网站配置
        function loadSiteConfig() {
            fetch('/api/site-config')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('网络响应错误');
                    }
                    return response.json();
                })
                .then(config => {
                    // 更新网站名称
                    if (config.siteName) {
                        const siteNameElement = document.getElementById('siteName');
                        if (siteNameElement) {
                            siteNameElement.textContent = config.siteName;
                        }
                        
                        const pageTitleElement = document.querySelector('title');
                        if (pageTitleElement) {
                            const originalTitle = pageTitleElement.textContent;
                            const titleParts = originalTitle.split(' - ');
                            if (titleParts.length > 1) {
                                pageTitleElement.textContent = titleParts[0] + ' - ' + config.siteName;
                            }
                        }
                    }
                    
                    // 更新logo
                    if (config.logo) {
                        const logoElement = document.getElementById('siteLogo');
                        if (logoElement) {
                            logoElement.src = config.logo;
                        }
                    }
                    
                    // 更新meta标签
                    if (config.keywords) {
                        const keywordsElement = document.querySelector('meta[name="keywords"]');
                        if (keywordsElement) {
                            keywordsElement.content = config.keywords;
                        }
                    }
                    
                    if (config.description) {
                        const descriptionElement = document.querySelector('meta[name="description"]');
                        if (descriptionElement) {
                            descriptionElement.content = config.description;
                        }
                    }
                    
                    // 更新社交媒体链接
                    if (config.telegramLink) {
                        const telegramLink1 = document.getElementById('telegramLink1');
                        if (telegramLink1) {
                            telegramLink1.href = config.telegramLink;
                        }
                    }
                    
                    if (config.xLink) {
                        const xLinkElement = document.getElementById('xLink');
                        if (xLinkElement) {
                            xLinkElement.href = config.xLink;
                        }
                    }
                })
                .catch(error => {
                    console.error('加载网站配置失败:', error);
                });
        }
        
        // 页面加载时获取配置
        document.addEventListener('DOMContentLoaded', loadSiteConfig);
    </script>
    <!-- 引入语言切换组件 -->
    <script src="../lang.js"></script>
    <!-- 自定义配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        dark: '#111827',
                        light: '#F9FAFB'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="font-inter bg-light text-dark antialiased">
    <!-- 导航栏占位符 -->
    <div id="navbar-placeholder"></div>

    <!-- 文章列表 -->
    <section class="articles-section pt-20 sm:pt-28">
        <div class="articles-container mx-auto px-4 sm:px-6 lg:px-8">
            <h1 data-lang-key="articles.title">文章列表</h1>
            <div class="articles-list" id="articles-list">
                <!-- 文章列表将通过JavaScript动态加载 -->
            </div>
            <div class="pagination" id="pagination">
                <!-- 分页控件将通过JavaScript动态加载 -->
            </div>
        </div>
    </section>

    <!-- 悬浮社交按钮占位符 -->
    <div id="social-floating-placeholder"></div>

    <!-- 底部占位符 -->
    <div id="footer-placeholder"></div>

    <!-- 移动端导航栏占位符 -->
    <div id="mobile-navbar-placeholder"></div>

    <!-- 引入组件加载脚本 -->
    <script src="../js/components.js"></script>

    <script>
        // 页面加载完成后加载文章列表
        document.addEventListener('DOMContentLoaded', function() {
            loadArticles(1); // 加载第一页
            
            // 监听语言切换事件
            document.addEventListener('languageChanged', function(e) {
                console.log('Language changed to:', e.detail.language);
                // 重新翻译页面内容
                if (typeof langSwitcher !== 'undefined' && langSwitcher.translatePage) {
                    setTimeout(() => langSwitcher.translatePage(), 10);
                }
                
                // 自动更新页面特定元素
                updatePageContent(e.detail.language);
            });
        });

        // 加载文章列表
        function loadArticles(page) {
            const articlesList = document.getElementById('articles-list');
            articlesList.innerHTML = '<p>正在加载文章...</p>';
            
            // 由于后端API不支持分页，我们忽略page参数直接获取所有文章
            fetch(`/api/articles`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // 手动实现分页逻辑
                        const articles = data.articles;
                        const articlesPerPage = 6; // 每页显示5篇文章
                        const totalPages = Math.ceil(articles.length / articlesPerPage);
                        const currentPage = page || 1;
                        const startIndex = (currentPage - 1) * articlesPerPage;
                        const endIndex = startIndex + articlesPerPage;
                        const pageArticles = articles.slice(startIndex, endIndex);
                        
                        renderArticles(pageArticles, totalPages, currentPage, articles.length);
                    } else {
                        articlesList.innerHTML = '<p>加载文章失败</p>';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    articlesList.innerHTML = '<p>加载文章时出错</p>';
                });
        }

        // 渲染文章列表
        function renderArticles(articles, totalPages, currentPage, totalArticles) {
            const articlesList = document.getElementById('articles-list');
            articlesList.innerHTML = '';
            
            if (articles.length === 0) {
                articlesList.innerHTML = '<p>暂无文章</p>';
                return;
            }
            
            articles.forEach(article => {
                // 如果文章有摘要字段就使用摘要，否则从内容中截取
                let excerpt = '';
                if (article.excerpt) {
                    excerpt = article.excerpt;
                } else if (article.content) {
                    // 从内容中提取纯文本并截取前100个字符
                    const tempDiv = document.createElement('div');
                    tempDiv.innerHTML = article.content;
                    excerpt = tempDiv.textContent.substring(0, 100) + '...';
                }
                
                const articleElement = document.createElement('div');
                articleElement.className = 'article-item mb-6 p-4 border border-gray-200 rounded-lg hover:shadow-md transition-shadow';
                articleElement.innerHTML = `
                    <h2 class="text-xl font-bold mb-2"><a href="new/article-${article.id}.html" target="_blank" class="text-primary hover:text-secondary">${article.title}</a></h2>
                    <p class="article-meta text-gray-500 text-sm mb-3">${article.date}</p>
                    <p class="article-excerpt text-gray-700 mb-4">${excerpt}</p>
                    <a href="new/article-${article.id}.html" target="_blank" class="text-primary hover:text-secondary font-medium">阅读更多 →</a>
                `;
                articlesList.appendChild(articleElement);
            });
            
            // 渲染分页控件
            renderPagination(totalPages, currentPage, totalArticles);
        }

        // 渲染分页控件
        function renderPagination(totalPages, currentPage, totalArticles) {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // 添加文章统计信息
            const stats = document.createElement('div');
            stats.className = 'mb-4 text-gray-600';
            stats.innerHTML = `共 ${totalArticles} 篇文章`;
            pagination.appendChild(stats);
            
            // 创建分页按钮容器
            const buttonsContainer = document.createElement('div');
            buttonsContainer.className = 'flex space-x-2';
            
            // 上一页按钮
            if (currentPage > 1) {
                const prevButton = document.createElement('button');
                prevButton.textContent = '上一页';
                prevButton.className = 'px-3 py-1 border border-gray-300 rounded hover:bg-gray-100';
                prevButton.onclick = () => loadArticles(currentPage - 1);
                buttonsContainer.appendChild(prevButton);
            }
            
            // 页码按钮
            for (let i = 1; i <= totalPages; i++) {
                const pageButton = document.createElement('button');
                pageButton.textContent = i;
                pageButton.className = `px-3 py-1 border rounded ${
                    i === currentPage 
                        ? 'bg-primary text-white border-primary' 
                        : 'border-gray-300 hover:bg-gray-100'
                }`;
                pageButton.onclick = () => loadArticles(i);
                buttonsContainer.appendChild(pageButton);
            }
            
            // 下一页按钮
            if (currentPage < totalPages) {
                const nextButton = document.createElement('button');
                nextButton.textContent = '下一页';
                nextButton.className = 'px-3 py-1 border border-gray-300 rounded hover:bg-gray-100';
                nextButton.onclick = () => loadArticles(currentPage + 1);
                buttonsContainer.appendChild(nextButton);
            }
            
            pagination.appendChild(buttonsContainer);
        }
        // 自动更新页面内容
        function updatePageContent(language) {
            // 更新页面标题
            const titleTranslations = {
                zh: '文章列表 - 谷比算力',
                en: 'Article List - Gubi Analytics'
            };
            
            document.title = titleTranslations[language] || titleTranslations.zh;
            
            // 更新 meta 标签
            const metaKeywords = {
                zh: '区块链策略开发, 量化交易策略, 数据采集, 行情数据接口, K线数据, 交易所API, 策略回测, Web3数据, 区块链数据分析, 自动化交易',
                en: 'blockchain strategy development, quantitative trading strategy, data collection, market data interface, K-line data, exchange API, strategy backtesting, Web3 data, blockchain data analysis, automated trading'
            };
            
            const metaDescription = {
                zh: '我们专注于区块链与量化交易领域，提供策略开发、数据采集、行情接口与回测服务，助力用户高效获取链上与交易所数据，打造智能化交易与分析解决方案。',
                en: 'We specialize in blockchain and quantitative trading, providing strategy development, data collection, market interfaces and backtesting services to help users efficiently obtain on-chain and exchange data, creating intelligent trading and analysis solutions.'
            };
            
            const keywordsMeta = document.querySelector('meta[name="keywords"]');
            const descriptionMeta = document.querySelector('meta[name="description"]');
            
            if (keywordsMeta) {
                keywordsMeta.setAttribute('content', metaKeywords[language] || metaKeywords.zh);
            }
            
            if (descriptionMeta) {
                descriptionMeta.setAttribute('content', metaDescription[language] || metaDescription.zh);
            }
            
            // 触发自定义事件，通知其他组件语言已更新
            document.dispatchEvent(new CustomEvent('pageContentUpdated', {
                detail: { language: language }
            }));
        }
    </script>
</body>
</html>