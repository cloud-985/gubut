<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <title>闪电贷攻击全解析：一笔交易如何完成 161 次代币转移？ - 谷比算力</title>
    <meta name="keywords" content="区块链策略开发, 量化交易策略, 数据采集, 行情数据接口, K线数据, 交易所API, 策略回测, Web3数据, 区块链数据分析, 自动化交易">
    <meta name="description" content="我们专注于区块链与量化交易领域，提供策略开发、数据采集、行情接口与回测服务，助力用户高效获取链上与交易所数据，打造智能化交易与分析解决方案。">    
    <!-- 引入Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- 引入Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- 引入样式文件 -->
    <link rel="stylesheet" href="../styles.css">
    <!-- 引入语言切换组件 -->
    <script src="../lang.js"></script>
        <!-- 自定义配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        dark: '#111827',
                        light: '#F9FAFB'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body>
    <!-- 导航栏占位符 -->
    <div id="navbar-placeholder"></div>

    <div class="article-container">
        <article class="article-content">
            <h1>闪电贷攻击全解析：一笔交易如何完成 161 次代币转移？</h1>
            <div class="article-meta">
                <span data-lang="zh">发布于: </span><span data-lang="en" class="hidden-lang">Published: </span>2025/10/11 16:27:26
            </div>
            <div class="article-body">
                <div class="article-body">
<p data-start="86" data-end="334">最近，随着多起闪电贷（Flash Loan）套利与攻击事件的发生，这一概念再次成为区块链领域的热门话题。早在 2021 年初，Yearn Finance 就曾遭遇闪电贷攻击。我们追踪其中一笔交易（<a class="decorated-link" href="https://cn.etherscan.com/tx/0x6dc268706818d1e6503739950abc5ba2211fc6b451e54244da7b1e226b12e027" target="_new" rel="noopener" data-start="184" data-end="286">交易详情</a>），发现短短一笔链上操作，竟然涉及 <strong data-start="304" data-end="317">161 次代币转移</strong>，刷新了人们对智能合约的认知。</p>
<p data-start="336" data-end="415">问题来了：为什么黑客能够在几秒钟之内完成从 dYdX 借款、抵押至 Compound、再一系列操作后完成还款的全过程？答案就在以太坊智能合约的底层机制中。</p>
<hr data-start="417" data-end="420">
<h2 data-start="422" data-end="437">智能合约存储在哪里？</h2>
<p data-start="439" data-end="495">以太坊上的智能合约并不是存在某个&ldquo;服务器&rdquo;上，而是写入到区块链的 <strong data-start="472" data-end="490">状态数据库（StateDB）</strong> 中。</p>
<ul data-start="496" data-end="619">
<li data-start="496" data-end="530">
<p data-start="498" data-end="530">当用户创建一个合约时，以太坊客户端会为其分配唯一的合约地址；</p>
</li>
<li data-start="531" data-end="582">
<p data-start="533" data-end="582">合约的代码和数据会被存储在本地的 StateDB 中，并最终持久化到 <strong data-start="568" data-end="579">LevelDB</strong>；</p>
</li>
<li data-start="583" data-end="619">
<p data-start="585" data-end="619">任何以太坊节点都可以通过合约地址加载代码到内存，并由虚拟机执行。</p>
</li>
</ul>
<p data-start="621" data-end="665">这意味着矿工本地就能完整运行合约逻辑，无需跨网络请求，从而保证了执行的高速与确定性。</p>
<ul>
<li><img src="https://static.aicoinstorge.com/attachment/article/20210324/161655860382495.jpg"></li>
</ul>
<hr data-start="667" data-end="670">
<h2 data-start="672" data-end="688">智能合约是如何执行的？</h2>
<p data-start="690" data-end="771">以太坊使用 <strong data-start="696" data-end="729">EVM（Ethereum Virtual Machine）</strong> 执行合约代码。EVM 定义了一系列指令，每个指令对应执行逻辑与消耗的 Gas。</p>
<ul data-start="773" data-end="885">
<li data-start="773" data-end="794">
<p data-start="775" data-end="794">合约复杂度越高，Gas 消耗越大；</p>
</li>
<li data-start="795" data-end="854">
<p data-start="797" data-end="854">在这笔闪电贷攻击交易中，Gas 消耗高达 <strong data-start="818" data-end="831">8,644,044</strong>，约占一个区块容量的 <strong data-start="842" data-end="851">74.3%</strong>；</p>
</li>
<li data-start="855" data-end="885">
<p data-start="857" data-end="885">黑客为此支付了 <strong data-start="865" data-end="877">3.37 ETH</strong> 的矿工费。</p>
</li>
</ul>
<p data-start="887" data-end="928">这也是为什么闪电贷虽然看似&ldquo;零成本借钱&rdquo;，但实际上背后仍有高额矿工费需要承担。</p>
<p data-start="887" data-end="928"><img src="https://static.aicoinstorge.com/attachment/article/20210324/161655860446810.jpg"></p>
<hr data-start="930" data-end="933">
<h2 data-start="935" data-end="951">合约之间如何相互调用？</h2>
<p data-start="953" data-end="985">合约调用另一个合约，最终会被编译为 <strong data-start="971" data-end="982">CALL 指令</strong>。</p>
<ul data-start="987" data-end="1076">
<li data-start="987" data-end="1016">
<p data-start="989" data-end="1016">CALL 本身的基础费用为 <strong data-start="1003" data-end="1013">40 Gas</strong>；</p>
</li>
<li data-start="1017" data-end="1040">
<p data-start="1019" data-end="1040">实际开销取决于被调用合约的执行复杂度；</p>
</li>
<li data-start="1041" data-end="1076">
<p data-start="1043" data-end="1076">所有调用过程都在矿工本地客户端中完成，不需要跨客户端网络交互。</p>
</li>
</ul>
<p data-start="1078" data-end="1123">因此，一笔闪电贷攻击交易能在同一客户端内快速完成&ldquo;借款、抵押、兑换、还款&rdquo;等连续动作。</p>
<p data-start="1078" data-end="1123"><img src="https://static.aicoinstorge.com/attachment/article/20210324/161655860462161.jpg"></p>
<hr data-start="1125" data-end="1128">
<h2 data-start="1130" data-end="1147">如果合约执行失败会怎样？</h2>
<p data-start="1149" data-end="1175">以太坊为合约执行提供了 <strong data-start="1161" data-end="1172">快照与回滚机制</strong>：</p>
<ul data-start="1176" data-end="1282">
<li data-start="1176" data-end="1212">
<p data-start="1178" data-end="1212">在执行前，客户端会调用 <strong data-start="1190" data-end="1202">Snapshot</strong> 保存当前状态；</p>
</li>
<li data-start="1213" data-end="1257">
<p data-start="1215" data-end="1257">若执行中途出错，则调用 <strong data-start="1227" data-end="1247">RevertToSnapshot</strong> 回滚到原状态；</p>
</li>
<li data-start="1258" data-end="1282">
<p data-start="1260" data-end="1282">即便交易失败，Gas 费用依旧会被扣除。</p>
</li>
</ul>
<p data-start="1284" data-end="1328">这就是闪电贷攻击能够&ldquo;零风险试错&rdquo;的原因&mdash;&mdash;失败了也只是损失矿工费，而不会背上债务。</p>
<p data-start="1284" data-end="1328"><img src="https://static.aicoinstorge.com/attachment/article/20210324/161655860478760.jpg"></p>
<hr data-start="1330" data-end="1333">
<h2 data-start="1335" data-end="1342">总结</h2>
<p data-start="1344" data-end="1410">闪电贷攻击的本质，是利用了 <strong data-start="1358" data-end="1388">EVM 高速执行 + 合约调用链条 + 状态回滚机制</strong>，在一笔交易中完成复杂的套利与攻击操作。</p>
<ul data-start="1412" data-end="1501">
<li data-start="1412" data-end="1440">
<p data-start="1414" data-end="1440">所有操作均在矿工客户端本地完成，无需跨网络调用；</p>
</li>
<li data-start="1441" data-end="1465">
<p data-start="1443" data-end="1465">成功与否取决于交易能否率先被打包进区块；</p>
</li>
<li data-start="1466" data-end="1501">
<p data-start="1468" data-end="1501">尽管表面上&ldquo;零抵押借贷&rdquo;，但背后依旧需要高昂的 Gas 支出。</p>
</li>
</ul>
<p data-start="1503" data-end="1583">正因如此，闪电贷既成为了黑客的攻击利器，也被套利者视为&ldquo;空手套白狼&rdquo;的神器。未来，如何在智能合约设计中防御此类攻击，仍是 DeFi 领域亟待解决的核心问题。</p>
</div>
            </div>

            <div class="related-articles">
                <h3>更多文章</h3>
                <div id="related-articles-list">
                <!-- 相关文章将通过JavaScript动态加载 -->
                    <p>加载中...</p>
                </div>
                <div class="all-articles-link">
                    <a href="../articles.html">查看所有文章 →</a>
                </div>
            </div>
        </article>
    </div>

    <!-- 数据信号服务板块 -->
    <section class="py-8 min-h-[20vh] flex items-center justify-center bg-gradient-to-br from-blue-900 via-blue-800 to-purple-700 text-white">
        <div class="container mx-auto px-2 sm:px-6 lg:px-8 w-full">
            <div class="text-center max-w-3xl mx-auto mb-16">
                <h2 class="text-[clamp(1.5rem,3vw,2.5rem)] font-bold mb-4" data-lang-key="signals.title">
                    数据信号服务
                </h2>
                <p class="text-blue-100 text-lg" data-lang-key="signals.subtitle">
                    快人一步的行情数据，让你在别人还没反应时，就已经进场
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 justify-items-center">
                <div class="bg-white/10 backdrop-blur-md rounded-xl p-8 border border-white/20 hover:border-blue-300/50 transition-all duration-300 hover:shadow-lg hover:shadow-blue-400/20 transform hover:-translate-y-1 max-w-sm w-full">
                    <div class="w-16 h-16 mb-6 mx-auto flex items-center justify-center text-3xl">🔔</div>
                    <h3 class="text-xl font-bold mb-3 text-center" data-lang-key="signal.new.title">
                        新币上线提醒
                    </h3>
                    <p class="text-blue-100 text-center" data-lang-key="signal.new.desc">
                        第一时间获取新币上线信息，抢占先机
                    </p>
                </div>

                <div class="bg-white/10 backdrop-blur-md rounded-xl p-8 border border-white/20 hover:border-blue-300/50 transition-all duration-300 hover:shadow-lg hover:shadow-blue-400/20 transform hover:-translate-y-1 max-w-sm w-full">
                    <div class="w-16 h-16 mb-6 mx-auto flex items-center justify-center text-3xl">🚀</div>
                    <h3 class="text-xl font-bold mb-3 text-center" data-lang-key="signal.market.title">
                        市场异动推送
                    </h3>
                    <p class="text-blue-100 text-center" data-lang-key="signal.market.desc">
                        实时推送资金流异常、盘口深度变化等关键信号
                    </p>
                </div>

                <div class="bg-white/10 backdrop-blur-md rounded-xl p-8 border border-white/20 hover:border-blue-300/50 transition-all duration-300 hover:shadow-lg hover:shadow-blue-400/20 transform hover:-translate-y-1 max-w-sm w-full">
                    <div class="w-16 h-16 mb-6 mx-auto flex items-center justify-center text-3xl">💎</div>
                    <h3 class="text-xl font-bold mb-3 text-center" data-lang-key="signal.vip.title">
                        VIP社群服务
                    </h3>
                    <p class="text-blue-100 text-center" data-lang-key="signal.vip.desc">
                        加入专属社群，获取全部信号和深度指标
                    </p>
                </div>
            </div>

            <div class="mt-16 text-center">
                <a href="https://t.me/mevjk_bot" class="inline-block bg-white hover:bg-blue-50 text-blue-900 font-bold py-4 px-8 rounded-full transition-all duration-300 shadow-lg shadow-blue-400/20 hover:shadow-xl hover:shadow-blue-400/30 transform hover:-translate-y-1" target="_blank" data-lang-key="signal.btn">
                    免费获取信号
                </a>
            </div>
        </div>
    </section>

    <!-- 悬浮社交按钮占位符 -->
    <div id="social-floating-placeholder"></div>

    <!-- 底部占位符 -->
    <div id="footer-placeholder"></div>

    <!-- 移动端底部导航栏占位符 -->
    <div id="mobile-navbar-placeholder"></div>

    <!-- 引入组件加载脚本 -->
    <script src="../js/components.js"></script>

    <script>
        // 页面加载完成后获取相关文章
        document.addEventListener('DOMContentLoaded', function() {
            loadRelatedArticles();
        });

        // 加载相关文章
        async function loadRelatedArticles() {
            const relatedArticlesList = document.getElementById('related-articles-list');

            try {
                // 从articles.json获取文章列表
                const response = await fetch('../articles.json');
                if (!response.ok) {
                    throw new Error('HTTP error! status: ' + response.status);
                }

                const articles = await response.json();
                
                // 获取当前文章ID（从URL中提取）
                const currentUrl = window.location.href;
                const matchResult = currentUrl.match(/article-(\d+)\.html/);
                const currentArticleId = matchResult ? matchResult[1] : null;

                // 过滤掉当前文章，并准备显示数据
                const relatedArticles = articles
                    .filter(article => article.id != currentArticleId) // 使用 != 因为ID可能是字符串或数字
                    .map(article => ({
                        id: article.id,
                        title: article.title,
                        date: article.date || "",  // 如果没有日期字段则为空
                        url: "../new/article-" + article.id + ".html"
                    }));

                // 按日期排序，最新的在前面
                relatedArticles.sort((a, b) => {
                    if (a.date && b.date) {
                        // 如果都有日期，按日期排序
                        return new Date(b.date) - new Date(a.date);
                    } else if (a.date) {
                        // 有日期的排在前面
                        return -1;
                    } else if (b.date) {
                        // 有日期的排在前面
                        return 1;
                    } else {
                        // 都没有日期，保持原有顺序
                        return 0;
                    }
                });

                displayRelatedArticles(relatedArticles);
            } catch (error) {
                console.error('加载相关文章失败:', error);
                relatedArticlesList.innerHTML = '<p>加载相关文章失败</p>';
            }
        }

        // 显示相关文章
        function displayRelatedArticles(articles) {
            const relatedArticlesList = document.getElementById('related-articles-list');

            if (!articles || articles.length === 0) {
                relatedArticlesList.innerHTML = '<p>暂无相关文章</p>';
                return;
            }

            // 最多显示20篇
            const relatedArticles = articles.slice(0, 20);

            // 清空当前列表
            relatedArticlesList.innerHTML = '';

            // 添加相关文章
            relatedArticles.forEach(article => {
                const relatedArticle = document.createElement('div');
                relatedArticle.className = 'related-article';

                // 构造文章显示内容
                let articleHTML = '<a href="' + article.url + '">' + escapeHtml(article.title) + '</a>';
                if (article.date) {
                    articleHTML += '<span class="related-article-date">' + article.date + '</span>';
                }

                relatedArticle.innerHTML = articleHTML;
                relatedArticlesList.appendChild(relatedArticle);
            });
        }

        // 简单的HTML转义函数，防止XSS攻击
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };

            return text.replace(/[&<>"']/g, function(m) { return map[m]; });
        }
    </script>
</body>
</html>